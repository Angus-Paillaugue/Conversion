import{s as Se,p as R,f as T,a as P,l as ee,r as Te,g as j,u as K,d as $,c as U,h as L,m as te,v as je,j as g,w as S,i as M,U as X,o as Ne,x as Y,z as G,K as Ie,A as be,I as $e,n as Me,N as ve}from"../chunks/scheduler.48e732d9.js";import{S as Oe,i as Le,h as Z,b as z,d as F,m as H,a as A,t as B,e as W,g as Pe,c as Ue}from"../chunks/index.d806ca90.js";import{e as pe}from"../chunks/each.7f778bc3.js";import{e as we}from"../chunks/forms.e3321b62.js";import{n as he}from"../chunks/stores.cc8b6fab.js";import{M as Ae}from"../chunks/Modal.f9da1938.js";import{C as ie}from"../chunks/Card.33695d8a.js";import{T as ke}from"../chunks/TextInput.aba2b0c1.js";import{T as Be}from"../chunks/Textarea.3014841e.js";import{I as ce}from"../chunks/Icon.c5b4ca42.js";import{S as qe}from"../chunks/Spinner.da9fd2c5.js";function _e(t,e,s){const n=t.slice();return n[31]=e[s],n}function Ve(t){let e;return{c(){e=T("div"),this.h()},l(s){e=j(s,"DIV",{class:!0}),L(e).forEach($),this.h()},h(){g(e,"class","w-full")},m(s,n){M(s,e,n),t[9](e)},p:Y,d(s){s&&$(e),t[9](null)}}}function ge(t){let e,s=t[31].email+"",n,u,a,l,_,h,x,w,c,d,D="<em></em>",o,v,k,N,f;function y(...C){return t[13](t[31],...C)}return{c(){e=T("form"),n=ee(s),u=P(),a=T("div"),l=T("input"),w=P(),c=T("label"),d=T("span"),d.innerHTML=D,v=P(),this.h()},l(C){e=j(C,"FORM",{action:!0,method:!0,class:!0});var p=L(e);n=te(p,s),u=U(p),a=j(p,"DIV",{class:!0});var i=L(a);l=j(i,"INPUT",{type:!0,id:!0,name:!0,class:!0}),w=U(i),c=j(i,"LABEL",{for:!0});var r=L(c);d=j(r,"SPAN",{"data-svelte-h":!0}),K(d)!=="svelte-1qeeisj"&&(d.innerHTML=D),r.forEach($),i.forEach($),v=U(p),p.forEach($),this.h()},h(){g(l,"type","checkbox"),g(l,"id",_="sendEmail-"+t[31].email),g(l,"name",h="sendEmails-"+t[31].email),l.checked=x=t[31].sendEmails,g(l,"class","hidden"),g(c,"for",o="sendEmail-"+t[31].email),g(a,"class","switch-wrapper opacity-0 group-hover:opacity-100 transition-all"),g(e,"action","?/sendEmails"),g(e,"method","POST"),g(e,"class","w-full transition-all text-text-main dark:text-neutral-100 dark:hover:bg-neutral-600 hover:bg-neutral-100 p-2 cursor-pointer rounded-lg hover:px-4 items-center relative group flex flex-row justify-between")},m(C,p){M(C,e,p),S(e,n),S(e,u),S(e,a),S(a,l),S(a,w),S(a,c),S(c,d),S(e,v),N||(f=[G(l,"change",Qe),$e(k=we.call(null,e,y))],N=!0)},p(C,p){t=C,p[0]&2&&s!==(s=t[31].email+"")&&Me(n,s),p[0]&2&&_!==(_="sendEmail-"+t[31].email)&&g(l,"id",_),p[0]&2&&h!==(h="sendEmails-"+t[31].email)&&g(l,"name",h),p[0]&2&&x!==(x=t[31].sendEmails)&&(l.checked=x),p[0]&2&&o!==(o="sendEmail-"+t[31].email)&&g(c,"for",o),k&&ve(k.update)&&p[0]&2&&k.update.call(null,y)},d(C){C&&$(e),N=!1,be(f)}}}function ze(t){let e,s,n,u,a,l,_,h,x,w,c,d,D,o,v,k,N;u=new ce({props:{icon:"heroicons:magnifying-glass",class:"w-4 h-4"}});function f(i){t[11](i)}let y={label:"Search",type:"text",placeholder:"Search users by usernames",name:"search"};t[0]!==void 0&&(y.value=t[0]),_=new ke({props:y}),R.push(()=>Z(_,"value",f)),c=new ce({props:{icon:"heroicons:x-mark",class:"w-6 h-6 transition-all group-hover:rotate-90"}});let C=pe(t[1]),p=[];for(let i=0;i<C.length;i+=1)p[i]=ge(_e(t,C,i));return{c(){e=T("h5"),s=ee(`Newsletter status\r
                    `),n=T("button"),z(u.$$.fragment),a=P(),l=T("div"),z(_.$$.fragment),x=P(),w=T("button"),z(c.$$.fragment),D=P(),o=T("div");for(let i=0;i<p.length;i+=1)p[i].c();this.h()},l(i){e=j(i,"H5",{class:!0});var r=L(e);s=te(r,`Newsletter status\r
                    `),n=j(r,"BUTTON",{class:!0});var b=L(n);F(u.$$.fragment,b),b.forEach($),r.forEach($),a=U(i),l=j(i,"DIV",{class:!0});var E=L(l);F(_.$$.fragment,E),x=U(E),w=j(E,"BUTTON",{type:!0,class:!0});var O=L(w);F(c.$$.fragment,O),O.forEach($),E.forEach($),D=U(i),o=j(i,"DIV",{class:!0});var q=L(o);for(let I=0;I<p.length;I+=1)p[I].l(q);q.forEach($),this.h()},h(){g(n,"class","w-fit button-secondary button-small"),g(e,"class","w-full border-b border-neutral-200 dark:border-neutral-700 flex flex-row p-2 items-center justify-between"),g(w,"type","button"),g(w,"class","group absolute top-1 right-1 button-close"),g(l,"class",d="bg-neutral-100 dark:bg-neutral-700 rounded-lg p-2.5 absolute top-0 left-0 right-0 transition-all "+(t[2]?"z-10 opacity-100":"-z-10 opacity-0")),g(o,"class","flex flex-col gap-0 overflow-y-auto overflow-x-hidden")},m(i,r){M(i,e,r),S(e,s),S(e,n),H(u,n,null),M(i,a,r),M(i,l,r),H(_,l,null),S(l,x),S(l,w),H(c,w,null),M(i,D,r),M(i,o,r);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(o,null);v=!0,k||(N=[G(n,"click",t[10]),G(w,"click",t[12])],k=!0)},p(i,r){const b={};if(!h&&r[0]&1&&(h=!0,b.value=i[0],X(()=>h=!1)),_.$set(b),(!v||r[0]&4&&d!==(d="bg-neutral-100 dark:bg-neutral-700 rounded-lg p-2.5 absolute top-0 left-0 right-0 transition-all "+(i[2]?"z-10 opacity-100":"-z-10 opacity-0")))&&g(l,"class",d),r[0]&2){C=pe(i[1]);let E;for(E=0;E<C.length;E+=1){const O=_e(i,C,E);p[E]?p[E].p(O,r):(p[E]=ge(O),p[E].c(),p[E].m(o,null))}for(;E<p.length;E+=1)p[E].d(1);p.length=C.length}},i(i){v||(A(u.$$.fragment,i),A(_.$$.fragment,i),A(c.$$.fragment,i),v=!0)},o(i){B(u.$$.fragment,i),B(_.$$.fragment,i),B(c.$$.fragment,i),v=!1},d(i){i&&($(e),$(a),$(l),$(D),$(o)),W(u),W(_),W(c),Ie(p,i),k=!1,be(N)}}}function Fe(t){let e,s="Send new newsletter",n,u;return{c(){e=T("button"),e.textContent=s,this.h()},l(a){e=j(a,"BUTTON",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-1tp2sp3"&&(e.textContent=s),this.h()},h(){g(e,"class","button-primary")},m(a,l){M(a,e,l),n||(u=G(e,"click",t[14]),n=!0)},p:Y,d(a){a&&$(e),n=!1,u()}}}function He(t){let e,s,n="In email subject and body, you can use use {{email}} to insert the user's email",u,a,l,_,h,x,w,c,d,D;function o(f){t[16](f)}let v={label:"Email subject",type:"text",placeholder:"Subject",name:"subject",id:"subject"};t[6].subject!==void 0&&(v.value=t[6].subject),a=new ke({props:v}),R.push(()=>Z(a,"value",o));function k(f){t[17](f)}let N={label:"Newsletter contents",rows:"10",placeholder:"Contents",name:"contents",id:"contents"};return t[6].contents!==void 0&&(N.value=t[6].contents),h=new Be({props:N}),R.push(()=>Z(h,"value",k)),{c(){e=T("form"),s=T("p"),s.textContent=n,u=P(),z(a.$$.fragment),_=P(),z(h.$$.fragment),this.h()},l(f){e=j(f,"FORM",{action:!0,method:!0,id:!0,slot:!0,class:!0});var y=L(e);s=j(y,"P",{"data-svelte-h":!0}),K(s)!=="svelte-10xr2bd"&&(s.textContent=n),u=U(y),F(a.$$.fragment,y),_=U(y),F(h.$$.fragment,y),y.forEach($),this.h()},h(){g(e,"action","?/newMail"),g(e,"method","POST"),g(e,"id","newNewsletterForm"),g(e,"slot","body"),g(e,"class","flex flex-col gap-4")},m(f,y){M(f,e,y),S(e,s),S(e,u),H(a,e,null),S(e,_),H(h,e,null),c=!0,d||(D=$e(w=we.call(null,e,t[18])),d=!0)},p(f,y){const C={};!l&&y[0]&64&&(l=!0,C.value=f[6].subject,X(()=>l=!1)),a.$set(C);const p={};!x&&y[0]&64&&(x=!0,p.value=f[6].contents,X(()=>x=!1)),h.$set(p),w&&ve(w.update)&&y[0]&16&&w.update.call(null,f[18])},i(f){c||(A(a.$$.fragment,f),A(h.$$.fragment,f),c=!0)},o(f){B(a.$$.fragment,f),B(h.$$.fragment,f),c=!1},d(f){f&&$(e),W(a),W(h),d=!1,D()}}}function We(t){let e;return{c(){e=ee("Send")},l(s){e=te(s,"Send")},m(s,n){M(s,e,n)},i:Y,o:Y,d(s){s&&$(e)}}}function Re(t){let e,s;return e=new qe({}),{c(){z(e.$$.fragment)},l(n){F(e.$$.fragment,n)},m(n,u){H(e,n,u),s=!0},i(n){s||(A(e.$$.fragment,n),s=!0)},o(n){B(e.$$.fragment,n),s=!1},d(n){W(e,n)}}}function Ge(t){let e,s="Cancel",n,u,a,l,_,h,x,w;const c=[Re,We],d=[];function D(o,v){return o[4]?0:1}return a=D(t),l=d[a]=c[a](t),{c(){e=T("button"),e.textContent=s,n=P(),u=T("button"),l.c(),this.h()},l(o){e=j(o,"BUTTON",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-h9xgp3"&&(e.textContent=s),n=U(o),u=j(o,"BUTTON",{form:!0,class:!0});var v=L(u);l.l(v),v.forEach($),this.h()},h(){var o,v;g(e,"class","button-secondary"),g(u,"form","newNewsletterForm"),g(u,"class","button-primary"),u.disabled=_=((o=t[6].subject)==null?void 0:o.length)===0||((v=t[6].contents)==null?void 0:v.length)===0},m(o,v){M(o,e,v),M(o,n,v),M(o,u,v),d[a].m(u,null),h=!0,x||(w=G(e,"click",t[15]),x=!0)},p(o,v){var N,f;let k=a;a=D(o),a!==k&&(Pe(),B(d[k],1,1,()=>{d[k]=null}),Ue(),l=d[a],l||(l=d[a]=c[a](o),l.c()),A(l,1),l.m(u,null)),(!h||v[0]&64&&_!==(_=((N=o[6].subject)==null?void 0:N.length)===0||((f=o[6].contents)==null?void 0:f.length)===0))&&(u.disabled=_)},i(o){h||(A(l),h=!0)},o(o){B(l),h=!1},d(o){o&&($(e),$(n),$(u)),d[a].d(),x=!1,w()}}}function Ke(t){let e,s="",n,u,a,l,_,h,x,w,c,d,D,o,v,k,N,f,y,C;h=new ce({props:{icon:"heroicons:arrow-uturn-left",class:"w-6 h-6 transition-all group-hover:rotate-[360deg] duration-300"}}),d=new ie({props:{class:"md:col-span-2",$$slots:{default:[Ve]},$$scope:{ctx:t}}}),o=new ie({props:{class:"relative",$$slots:{default:[ze]},$$scope:{ctx:t}}}),k=new ie({props:{$$slots:{default:[Fe]},$$scope:{ctx:t}}});function p(r){t[19](r)}let i={title:"New newsletter mail",$$slots:{footer:[Ge],body:[He]},$$scope:{ctx:t}};return t[3]!==void 0&&(i.status=t[3]),f=new Ae({props:i}),R.push(()=>Z(f,"status",p)),{c(){e=T("script"),e.innerHTML=s,u=P(),a=T("section"),l=T("div"),_=T("a"),z(h.$$.fragment),x=ee(`\r
            Go back`),w=P(),c=T("div"),z(d.$$.fragment),D=P(),z(o.$$.fragment),v=P(),z(k.$$.fragment),N=P(),z(f.$$.fragment),this.h()},l(r){const b=Te("svelte-1eai",document.head);e=j(b,"SCRIPT",{src:!0,"data-svelte-h":!0}),K(e)!=="svelte-avrofd"&&(e.innerHTML=s),b.forEach($),u=U(r),a=j(r,"SECTION",{class:!0});var E=L(a);l=j(E,"DIV",{class:!0});var O=L(l);_=j(O,"A",{href:!0,class:!0});var q=L(_);F(h.$$.fragment,q),x=te(q,`\r
            Go back`),q.forEach($),w=U(O),c=j(O,"DIV",{class:!0});var I=L(c);F(d.$$.fragment,I),D=U(I),F(o.$$.fragment,I),v=U(I),F(k.$$.fragment,I),I.forEach($),O.forEach($),E.forEach($),N=U(r),F(f.$$.fragment,r),this.h()},h(){document.title="PCC - Newsletter management",je(e.src,n="https://cdn.jsdelivr.net/npm/apexcharts")||g(e,"src",n),g(_,"href","../"),g(_,"class","button-secondary w-fit button-small group"),g(c,"class","w-full h-full grid grid-cols-1 md:grid-cols-2 gap-6"),g(l,"class","max-w-screen-lg mx-auto flex flex-col gap-6"),g(a,"class","grow w-full py-8 px-4 lg:py-16 lg:px-6 space-y-6")},m(r,b){S(document.head,e),M(r,u,b),M(r,a,b),S(a,l),S(l,_),H(h,_,null),S(_,x),S(l,w),S(l,c),H(d,c,null),S(c,D),H(o,c,null),S(c,v),H(k,c,null),M(r,N,b),H(f,r,b),C=!0},p(r,b){const E={};b[0]&32|b[1]&8&&(E.$$scope={dirty:b,ctx:r}),d.$set(E);const O={};b[0]&7|b[1]&8&&(O.$$scope={dirty:b,ctx:r}),o.$set(O);const q={};b[0]&8|b[1]&8&&(q.$$scope={dirty:b,ctx:r}),k.$set(q);const I={};b[0]&88|b[1]&8&&(I.$$scope={dirty:b,ctx:r}),!y&&b[0]&8&&(y=!0,I.status=r[3],X(()=>y=!1)),f.$set(I)},i(r){C||(A(h.$$.fragment,r),A(d.$$.fragment,r),A(o.$$.fragment,r),A(k.$$.fragment,r),A(f.$$.fragment,r),C=!0)},o(r){B(h.$$.fragment,r),B(d.$$.fragment,r),B(o.$$.fragment,r),B(k.$$.fragment,r),B(f.$$.fragment,r),C=!1},d(r){r&&($(u),$(a),$(N)),$(e),W(h),W(d),W(o),W(k),W(f,r)}}}const ue=9,Qe=t=>{t.target.closest("form").requestSubmit()};function Je(t,e,s){var fe,me;let{form:n}=e,{data:u}=e;const{subscribers:a}=u;let l=a.slice(0,ue),_=!1,h=!1,x=!1,w,c,d={subject:((fe=n==null?void 0:n.formData)==null?void 0:fe.subject)??"",contents:((me=n==null?void 0:n.formData)==null?void 0:me.contents)??""};const D={};a.forEach(m=>{const V=m.joinedAt.toISOString().split("T")[0];D[V]=(D[V]||0)+1});const o=Object.keys(D),v=Math.min(...o.map(m=>new Date(m))),k=Math.max(new Date),N=[];for(let m=new Date(v);m<=k;m.setDate(m.getDate()+1)){const V=m.toISOString().split("T")[0];N.push(V)}const f=[];let y=0;N.forEach(m=>{const V=D[m]||0;y+=V,f.push({x:new Date(m).getDate()+"/"+(new Date(m).getMonth()+1),y})});let p={...{chart:{height:450,type:"line",toolbar:{show:!1}},colors:["#0da858"],dataLabels:{enabled:!0},stroke:{curve:"smooth"},grid:{borderColor:"#e7e7e7",row:{colors:["#f3f3f3","transparent"],opacity:.5}}},series:[{name:"Subscribers",data:f}],title:{text:"Subscribers progression",align:"left"},xaxis:{categories:Object.keys(D),title:{text:"Days"}},yaxis:{title:{text:"Subscribers"},min:0,max:Math.max(...f.map(m=>m.y))}};Ne(()=>{new ApexCharts(w,p).render()});function i(){if(!c){s(1,l=a.slice(0,ue));return}const m=2,V=c.toLowerCase().split(" ");s(1,l=a.filter(se=>{const de=se.email.toLowerCase().split(" ");for(let ne=0;ne<V.length;ne++){const ae=V[ne];let le=!1;for(let re=0;re<de.length;re++){const Q=de[re];if(Q.includes(ae)){le=!0;break}if(ae.length-Q.length<=m){let oe=0;for(let J=0;J<Q.length&&!(Q[J]!==ae[J]&&(oe++,oe>m));J++);if(oe<=m){le=!0;break}}}if(!le)return!1}return!0}).slice(0,ue))}function r(m){R[m?"unshift":"push"](()=>{w=m,s(5,w)})}const b=()=>{s(2,_=!_)};function E(m){c=m,s(0,c)}const O=()=>{s(2,_=!1),s(0,c="")},q=(m,V)=>(V.formData.set("email",m.email),({update:se})=>{se({reset:!1})}),I=()=>{s(3,h=!0)},ye=()=>{s(3,h=!1)};function Ce(m){t.$$.not_equal(d.subject,m)&&(d.subject=m,s(6,d))}function Ee(m){t.$$.not_equal(d.contents,m)&&(d.contents=m,s(6,d))}const xe=()=>(s(4,x=!0),({update:m})=>{s(4,x=!1),m({reset:!1})});function De(m){h=m,s(3,h)}return t.$$set=m=>{"form"in m&&s(7,n=m.form),"data"in m&&s(8,u=m.data)},t.$$.update=()=>{t.$$.dirty[0]&1&&i(),t.$$.dirty[0]&128&&n&&(n.type==="sendEmails"&&he(n.success?"success":"error",n.message),n.type==="newMail"&&he(n.success?"success":"error",n.message))},[c,l,_,h,x,w,d,n,u,r,b,E,O,q,I,ye,Ce,Ee,xe,De]}class it extends Oe{constructor(e){super(),Le(this,e,Je,Ke,Se,{form:7,data:8},null,[-1,-1])}}export{it as component};
